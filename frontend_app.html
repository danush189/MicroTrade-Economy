<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro Economy Trade Simulation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .controls { text-align: center; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .agent-card { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .agent-header { font-weight: bold; font-size: 18px; margin-bottom: 10px; padding: 10px; border-radius: 5px; }
        .producer { background: #e8f5e8; color: #2d5f3f; }
        .consumer { background: #e8f0ff; color: #2d4a75; }
        .market { background: #fff3e8; color: #7a4f1a; }
        .worker { background: #f0e8ff; color: #4a2d75; }
        .trader { background: #ffe8f0; color: #752d4a; }
        .stat { margin: 5px 0; }
        .health-bar { width: 100%; height: 20px; background: #ddd; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .health-fill { height: 100%; background: linear-gradient(90deg, #ff4444, #ffaa44, #44ff44); transition: width 0.3s; }
        .market-section { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .market-section h3 { margin-top: 0; }
        .offers, .requests { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .offer-card, .request-card { background: #f9f9f9; padding: 10px; border-radius: 5px; border-left: 4px solid #007bff; }
        .cycle-info { text-align: center; font-size: 24px; font-weight: bold; color: #333; margin-bottom: 20px; }
        button { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 0 10px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .log { background: white; padding: 15px; border-radius: 8px; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè™ Micro Economy Trade Simulation</h1>
            <p>A simple economic simulation with producers, consumers, traders, and workers</p>
        </div>

        <div class="cycle-info">
            Cycle: <span id="currentCycle">0</span>
        </div>

        <div class="controls">
            <button onclick="initializeEconomy()">Initialize Economy</button>
            <button onclick="runCycle()" id="runCycleBtn">Run Next Cycle</button>
            <button onclick="autoRun()" id="autoRunBtn">Auto Run (5 cycles)</button>
        </div>

        <div class="grid" id="agentsGrid">
            <!-- Agent cards will be populated here -->
        </div>

        <div class="market-section">
            <h3>üìà Market Activity</h3>
            <div class="grid">
                <div>
                    <h4>Current Offers</h4>
                    <div id="currentOffers" class="offers"></div>
                </div>
                <div>
                    <h4>Buy Requests</h4>
                    <div id="currentRequests" class="requests"></div>
                </div>
            </div>
            <div style="margin-top: 20px;">
                <h4>Market Prices</h4>
                <div id="marketPrices"></div>
            </div>
        </div>

        <div class="market-section">
            <h3>üìã Activity Log</h3>
            <div id="activityLog" class="log"></div>
        </div>
    </div>

    <script>
        // Simplified economy state
        let economy = {
            cycle: 0,
            agents: {},
            offers: [],
            requests: [],
            transactions: [],
            marketPrices: { food: 2.0 }
        };

        let isRunning = false;

        function initializeEconomy() {
            economy = {
                cycle: 0,
                agents: {
                    producer: { 
                        id: 'producer', 
                        name: 'Food Producer', 
                        goods: { food: 5 }, 
                        currency: 10, 
                        health: 100,
                        role: 'Produces food'
                    },
                    consumer: { 
                        id: 'consumer', 
                        name: 'Food Consumer', 
                        goods: { food: 2 }, 
                        currency: 10, 
                        health: 100,
                        role: 'Consumes food'
                    },
                    market: { 
                        id: 'market', 
                        name: 'Market Facilitator', 
                        goods: {}, 
                        currency: 0, 
                        health: 100,
                        role: 'Facilitates trades'
                    },
                    worker: { 
                        id: 'worker', 
                        name: 'Labor Provider', 
                        goods: { food: 2 }, 
                        currency: 10, 
                        health: 100,
                        role: 'Provides labor'
                    },
                    trader: { 
                        id: 'trader', 
                        name: 'Goods Trader', 
                        goods: { food: 2 }, 
                        currency: 10, 
                        health: 100,
                        role: 'Buys low, sells high'
                    }
                },
                offers: [],
                requests: [],
                transactions: [],
                marketPrices: { food: 2.0 }
            };
            
            updateDisplay();
            log("Economy initialized successfully!");
        }

        function runCycle() {
            if (isRunning) return;
            isRunning = true;
            
            economy.cycle++;
            document.getElementById('currentCycle').textContent = economy.cycle;
            
            log(`Starting Cycle ${economy.cycle}`);
            
            // Clear previous offers/requests
            economy.offers = [];
            economy.requests = [];
            economy.transactions = [];
            
            // Simulate agent actions
            simulateAgentActions();
            
            // End cycle
            endCycle();
            
            updateDisplay();
            isRunning = false;
        }

        function simulateAgentActions() {
            // Producer actions
            let producer = economy.agents.producer;
            producer.goods.food += 3; // Produce food
            log(`Producer produced 3 food (total: ${producer.goods.food})`);
            
            if (producer.goods.food > 3) {
                let sellQuantity = Math.floor(producer.goods.food / 2);
                let price = economy.marketPrices.food + (Math.random() - 0.5);
                economy.offers.push({
                    id: `offer_${Math.floor(Math.random() * 9999)}`,
                    seller: 'producer',
                    good: 'food',
                    quantity: sellQuantity,
                    price: Math.max(0.5, price)
                });
                log(`Producer created offer: ${sellQuantity} food at ${price.toFixed(2)} each`);
            }

            // Consumer actions
            let consumer = economy.agents.consumer;
            if (consumer.goods.food < 3) {
                economy.requests.push({
                    id: `request_${Math.floor(Math.random() * 9999)}`,
                    buyer: 'consumer',
                    good: 'food',
                    quantity: 2,
                    maxPrice: economy.marketPrices.food + 0.5
                });
                log(`Consumer created buy request: 2 food at max ${(economy.marketPrices.food + 0.5).toFixed(2)} each`);
            }

            // Worker actions
            let worker = economy.agents.worker;
            if (Math.random() > 0.5) {
                economy.offers.push({
                    id: `offer_${Math.floor(Math.random() * 9999)}`,
                    seller: 'worker',
                    good: 'labor',
                    quantity: 2,
                    price: 1.5
                });
                log(`Worker offered 2 labor units at 1.5 each`);
            }

            // Trader actions
            let trader = economy.agents.trader;
            if (trader.currency > 5 && Math.random() > 0.6) {
                economy.requests.push({
                    id: `request_${Math.floor(Math.random() * 9999)}`,
                    buyer: 'trader',
                    good: 'food',
                    quantity: 1,
                    maxPrice: economy.marketPrices.food - 0.3
                });
                log(`Trader created buy request: 1 food at max ${(economy.marketPrices.food - 0.3).toFixed(2)}`);
            }

            // Market matching
            matchOffers();
        }

        function matchOffers() {
            let matches = 0;
            
            for (let offer of economy.offers) {
                for (let request of economy.requests) {
                    if (offer.good === request.good && 
                        offer.price <= request.maxPrice && 
                        offer.quantity >= request.quantity) {
                        
                        // Execute trade
                        let seller = economy.agents[offer.seller];
                        let buyer = economy.agents[request.buyer];
                        
                        if (seller && buyer && 
                            (seller.goods[offer.good] || 0) >= request.quantity &&
                            buyer.currency >= (offer.price * request.quantity)) {
                            
                            // Transfer goods and currency
                            seller.goods[offer.good] = (seller.goods[offer.good] || 0) - request.quantity;
                            seller.currency += offer.price * request.quantity;
                            
                            buyer.goods[offer.good] = (buyer.goods[offer.good] || 0) + request.quantity;
                            buyer.currency -= offer.price * request.quantity;
                            
                            // Market fee
                            let fee = (offer.price * request.quantity) * 0.05;
                            economy.agents.market.currency += fee;
                            seller.currency -= fee;
                            
                            // Update market price
                            economy.marketPrices[offer.good] = offer.price;
                            
                            economy.transactions.push({
                                seller: offer.seller,
                                buyer: request.buyer,
                                good: offer.good,
                                quantity: request.quantity,
                                price: offer.price
                            });
                            
                            log(`Trade executed: ${request.quantity} ${offer.good} from ${offer.seller} to ${request.buyer} at ${offer.price.toFixed(2)} each`);
                            matches++;
                            
                            // Remove matched offer and request
                            economy.offers = economy.offers.filter(o => o.id !== offer.id);
                            economy.requests = economy.requests.filter(r => r.id !== request.id);
                            break;
                        }
                    }
                }
            }
            
            if (matches > 0) {
                log(`Market facilitated ${matches} trades`);
            }
        }

        function endCycle() {
            // All agents consume food
            for (let [agentId, agent] of Object.entries(economy.agents)) {
                if (agentId === 'market') continue;
                
                if ((agent.goods.food || 0) > 0 && agent.currency >= economy.marketPrices.food) {
                    agent.goods.food--;
                    agent.currency -= economy.marketPrices.food;
                    agent.health = Math.min(100, agent.health + 5);
                    log(`${agentId} consumed 1 food (health: ${agent.health})`);
                } else {
                    agent.health -= 15;
                    log(`${agentId} couldn't consume food (health: ${agent.health})`);
                }
            }
            
            log(`Cycle ${economy.cycle} completed\n`);
        }

        function autoRun() {
            let cycles = 0;
            const interval = setInterval(() => {
                runCycle();
                cycles++;
                if (cycles >= 5) {
                    clearInterval(interval);
                }
            }, 1500);
        }

        function updateDisplay() {
            updateAgentCards();
            updateMarketDisplay();
        }

        function updateAgentCards() {
            const grid = document.getElementById('agentsGrid');
            grid.innerHTML = '';
            
            for (let [agentId, agent] of Object.entries(economy.agents)) {
                const card = document.createElement('div');
                card.className = 'agent-card';
                
                const goodsDisplay = Object.entries(agent.goods || {})
                    .map(([good, qty]) => `${good}: ${qty}`)
                    .join(', ') || 'None';
                
                card.innerHTML = `
                    <div class="agent-header ${agentId}">${agent.name}</div>
                    <div class="stat">Role: ${agent.role}</div>
                    <div class="stat">üí∞ Currency: ${agent.currency.toFixed(2)}</div>
                    <div class="stat">üì¶ Goods: ${goodsDisplay}</div>
                    <div class="stat">‚ù§Ô∏è Health: ${agent.health}</div>
                    <div class="health-bar">
                        <div class="health-fill" style="width: ${agent.health}%"></div>
                    </div>
                `;
                
                grid.appendChild(card);
            }
        }

        function updateMarketDisplay() {
            // Update offers
            const offersDiv = document.getElementById('currentOffers');
            offersDiv.innerHTML = economy.offers.map(offer => `
                <div class="offer-card">
                    <strong>${offer.seller}</strong> sells<br>
                    ${offer.quantity} ${offer.good}<br>
                    @ ${offer.price.toFixed(2)} each
                </div>
            `).join('') || '<div>No current offers</div>';
            
            // Update requests
            const requestsDiv = document.getElementById('currentRequests');
            requestsDiv.innerHTML = economy.requests.map(request => `
                <div class="request-card">
                    <strong>${request.buyer}</strong> wants<br>
                    ${request.quantity} ${request.good}<br>
                    @ max ${request.maxPrice.toFixed(2)} each
                </div>
            `).join('') || '<div>No current requests</div>';
            
            // Update market prices
            const pricesDiv = document.getElementById('marketPrices');
            pricesDiv.innerHTML = Object.entries(economy.marketPrices)
                .map(([good, price]) => `<strong>${good}:</strong> ${price.toFixed(2)}`)
                .join(' | ');
        }

        function log(message) {
            const logDiv = document.getElementById('activityLog');
            logDiv.innerHTML += message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Initialize on page load
        initializeEconomy();
    </script>
</body>
</html>